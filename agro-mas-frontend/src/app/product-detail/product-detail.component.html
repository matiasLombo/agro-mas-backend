<div class="product-detail-container" *ngIf="!isLoading && product">
  <div class="product-detail-card">
    <!-- Header -->
    <div class="product-header">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="product-title">{{ product.title }}</h1>
      <div class="product-category-badge">{{ getCategoryName(product.category) }}</div>
    </div>

    <!-- Main Content -->
    <div class="product-main">
      <!-- Multimedia Section (Left) -->
      <div class="multimedia-section">
        <div class="image-container" [class.no-images]="images.length === 0">
          <img [src]="getCurrentImage()" [alt]="product.title" class="main-image">
          
          <!-- Placeholder overlay for products without images -->
          <div class="image-placeholder-overlay" *ngIf="images.length === 0">
            <div class="placeholder-content">
              <mat-icon class="placeholder-icon">image</mat-icon>
              <span class="placeholder-text">{{ getCategoryName(product.category) }}</span>
              <span class="placeholder-subtext">Sin imágenes disponibles</span>
            </div>
          </div>
          
          <!-- Navigation arrows for multiple images -->
          <div class="image-navigation" *ngIf="images.length > 1">
            <button mat-icon-button (click)="prevImage()" class="nav-button prev">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <button mat-icon-button (click)="nextImage()" class="nav-button next">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <!-- Image indicators -->
          <div class="image-indicators" *ngIf="images.length > 1">
            <div 
              *ngFor="let image of images; let i = index"
              class="indicator"
              [class.active]="i === currentImageIndex"
              (click)="currentImageIndex = i">
            </div>
          </div>
        </div>

        <!-- Thumbnail strip -->
        <div class="thumbnail-strip" *ngIf="images.length > 1">
          <div 
            *ngFor="let image of images; let i = index"
            class="thumbnail"
            [class.active]="i === currentImageIndex"
            (click)="currentImageIndex = i">
            <img [src]="image.image_url" [alt]="'Vista ' + (i + 1)">
          </div>
        </div>
      </div>

      <!-- Product Information Section (Right) -->
      <div class="info-section">
        <!-- Price -->
        <div class="price-section">
          <div class="price-label">Precio</div>
          <div class="price-value">{{ formatPrice(product) }}</div>
        </div>

        <!-- Description -->
        <div class="info-group" *ngIf="product.description">
          <label>Descripción</label>
          <p class="info-text">{{ product.description }}</p>
        </div>

        <!-- Location -->
        <div class="info-group">
          <label>Ubicación</label>
          <div class="location-info">
            <mat-icon class="location-icon">place</mat-icon>
            <span class="info-text">{{ locationName }}</span>
          </div>
        </div>

        <!-- Availability -->
        <div class="info-group" *ngIf="product.pickup_available || product.delivery_available">
          <label>Modalidades de entrega</label>
          <div class="delivery-options">
            <div class="delivery-option" *ngIf="product.pickup_available">
              <mat-icon class="option-icon">local_shipping</mat-icon>
              <span>Retiro en origen</span>
            </div>
            <div class="delivery-option" *ngIf="product.delivery_available">
              <mat-icon class="option-icon">delivery_dining</mat-icon>
              <span>Entrega a domicilio</span>
              <span *ngIf="product.delivery_radius" class="delivery-radius">
                (Radio: {{ product.delivery_radius }} km)
              </span>
            </div>
          </div>
        </div>

        <!-- Seller Info -->
        <div class="seller-section">
          <label>Vendedor</label>
          <div class="seller-info">
            <mat-icon class="seller-icon">person</mat-icon>
            <span class="seller-name">{{ product.seller_name }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <!-- Show edit button only for owners -->
          <button 
            *ngIf="isOwner" 
            mat-raised-button 
            color="primary" 
            (click)="editProduct()"
            class="action-button">
            <mat-icon>edit</mat-icon>
            Editar Publicación
          </button>

          <!-- Show contact button only for non-owners -->
          <button 
            *ngIf="!isOwner && isAuthenticated" 
            mat-raised-button 
            color="primary" 
            (click)="contactSeller()"
            class="action-button primary-action">
            <mat-icon>chat</mat-icon>
            Contactar
          </button>
          
          <!-- Show login prompt for non-authenticated users -->
          <button 
            *ngIf="!isOwner && !isAuthenticated" 
            mat-raised-button 
            color="accent" 
            (click)="goToLogin()"
            class="action-button login-prompt">
            <mat-icon>login</mat-icon>
            Inicia sesión para contactar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
  <p>Cargando producto...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="!isLoading && !product">
  <mat-icon class="error-icon">error</mat-icon>
  <h3>Producto no encontrado</h3>
  <p>El producto que buscas no existe o ha sido eliminado.</p>
  <button mat-raised-button color="primary" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
    Volver al marketplace
  </button>
</div>