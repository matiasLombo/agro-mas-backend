<div class="register-container">
  <div class="register-card">
    <h2>üåæ Crear Cuenta</h2>
    <p class="subtitle">√önete al marketplace agropecuario</p>

    <!-- Progress indicator -->
    <div class="progress-container">
      <div class="progress-bar">
        <div 
          class="progress-fill" 
          [style.width.%]="(currentStep / totalSteps) * 100"
        ></div>
      </div>
      <div class="step-labels">
        <span [class.active]="currentStep >= 1">1. Datos personales</span>
        <span [class.active]="currentStep >= 2">2. Crear cuenta</span>
      </div>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      
      <!-- Step 1: Personal Info -->
      <div class="step-content" *ngIf="currentStep === 1">
        <h3>Informaci√≥n Personal</h3>
        
        <div class="form-row">
          <div class="form-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre *</mat-label>
              <input
                matInput
                type="text"
                formControlName="firstName"
                placeholder="Tu nombre"
              >
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="isFieldInvalid('firstName')">
                {{ getFieldError('firstName') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Apellido *</mat-label>
              <input
                matInput
                type="text"
                formControlName="lastName"
                placeholder="Tu apellido"
              >
              <mat-icon matSuffix>person_outline</mat-icon>
              <mat-error *ngIf="isFieldInvalid('lastName')">
                {{ getFieldError('lastName') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Correo Electr√≥nico *</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              placeholder="tu@email.com"
            >
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="isFieldInvalid('email')">
              {{ getFieldError('email') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Tel√©fono</mat-label>
            <input
              matInput
              type="tel"
              formControlName="phone"
              placeholder="+54 11 1234-5678"
            >
            <mat-icon matSuffix>phone</mat-icon>
            <mat-error *ngIf="isFieldInvalid('phone')">
              {{ getFieldError('phone') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <div class="form-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Contrase√±a *</mat-label>
              <input
                matInput
                type="password"
                formControlName="password"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                autocomplete="new-password"
              >
              <mat-icon matSuffix>lock</mat-icon>
            
            <!-- Password Requirements -->
            <div class="password-requirements" *ngIf="registerForm.get('password')?.value || registerForm.get('password')?.touched">
              <h4>Requisitos de contrase√±a:</h4>
              <ul>
                <li [class.valid]="passwordHasMinLength()" [class.invalid]="!passwordHasMinLength()">
                  <span class="check-icon">{{ passwordHasMinLength() ? '‚úì' : '‚úó' }}</span>
                  Al menos 8 caracteres
                </li>
                <li [class.valid]="passwordHasMaxLength()" [class.invalid]="!passwordHasMaxLength()">
                  <span class="check-icon">{{ passwordHasMaxLength() ? '‚úì' : '‚úó' }}</span>
                  M√°ximo 128 caracteres
                </li>
                <li [class.valid]="passwordHasUppercase()" [class.invalid]="!passwordHasUppercase()">
                  <span class="check-icon">{{ passwordHasUppercase() ? '‚úì' : '‚úó' }}</span>
                  Una letra may√∫scula (A-Z)
                </li>
                <li [class.valid]="passwordHasLowercase()" [class.invalid]="!passwordHasLowercase()">
                  <span class="check-icon">{{ passwordHasLowercase() ? '‚úì' : '‚úó' }}</span>
                  Una letra min√∫scula (a-z)
                </li>
                <li [class.valid]="passwordHasNumber()" [class.invalid]="!passwordHasNumber()">
                  <span class="check-icon">{{ passwordHasNumber() ? '‚úì' : '‚úó' }}</span>
                  Un n√∫mero (0-9)
                </li>
                <li [class.valid]="passwordHasSpecialChar()" [class.invalid]="!passwordHasSpecialChar()">
                  <span class="check-icon">{{ passwordHasSpecialChar() ? '‚úì' : '‚úó' }}</span>
                  Un car√°cter especial (!&#64;#$%^&*)
                </li>
              </ul>
            </div>
            
              <mat-error *ngIf="isFieldInvalid('password')">
                {{ getFieldError('password') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-group">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmar Contrase√±a *</mat-label>
              <input
                matInput
                type="password"
                formControlName="confirmPassword"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                autocomplete="new-password"
              >
              <mat-icon matSuffix>lock_outline</mat-icon>
              <mat-error *ngIf="isFieldInvalid('confirmPassword')">
                {{ getFieldError('confirmPassword') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Step 2: Final Registration -->
      <div class="step-content" *ngIf="currentStep === 2">
        <h3>¬°Listo para crear tu cuenta!</h3>
        <p class="step-description">Tu cuenta se crear√° como comprador. Podr√°s configurar tu perfil de vendedor m√°s adelante si deseas publicar productos.</p>
        
        <div class="registration-summary">
          <h4>üìã Resumen de tu cuenta:</h4>
          <ul>
            <li><strong>Nombre:</strong> {{ registerForm.get('firstName')?.value }} {{ registerForm.get('lastName')?.value }}</li>
            <li><strong>Email:</strong> {{ registerForm.get('email')?.value }}</li>
            <li><strong>Tel√©fono:</strong> {{ registerForm.get('phone')?.value || 'No especificado' }}</li>
            <li><strong>Tipo:</strong> Comprador (puedes vender productos m√°s adelante)</li>
          </ul>
        </div>
      </div>

      <!-- Error message -->
      <div class="error-message general-error" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <!-- Navigation buttons -->
      <div class="form-navigation">
        <button
          type="button"
          class="btn btn-secondary"
          *ngIf="currentStep > 1"
          (click)="prevStep()"
        >
          ‚Üê Anterior
        </button>

        <button
          type="button"
          class="btn btn-primary"
          *ngIf="currentStep < totalSteps"
          (click)="nextStep()"
          [disabled]="!isStep1Valid()"
        >
          Siguiente ‚Üí
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          *ngIf="currentStep === totalSteps"
          [disabled]="loading"
        >
          <span *ngIf="loading">üîÑ Creando cuenta...</span>
          <span *ngIf="!loading">Crear Cuenta</span>
        </button>
      </div>
    </form>

    <div class="form-footer">
      <p>¬øYa tienes cuenta? 
        <a routerLink="/login" class="link">Inicia sesi√≥n aqu√≠</a>
      </p>
    </div>
  </div>
</div>