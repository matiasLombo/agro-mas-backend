<div class="marketplace-container">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title">Marketplace Agropecuario</h1>
        <p class="hero-subtitle">Conectamos productores y compradores en el sector agropecuario</p>
        <p class="hero-description">La plataforma de confianza donde encontrarás los mejores productos del campo argentino</p>
      </div>
      <div class="hero-image">
        <div class="hero-placeholder">
          <mat-icon class="hero-icon">agriculture</mat-icon>
        </div>
      </div>
    </div>
  </section>

  <section class="how-it-works-section" *ngIf="!isAuthenticated">
    <div class="section-header">
      <h2 class="section-title">Cómo Funciona</h2>
      <p class="section-subtitle">Un proceso simple y transparente.</p>
    </div>

    <div class="steps-container">
      <div class="step-card">
        <div class="icon-circle">
          <mat-icon class="material-symbols-outlined icon-style">
            person_check</mat-icon>
        </div>
        <h3>1. Regístrate y Publica</h3>
        <p>Crea una cuenta y publica tus productos o servicios en minutos.</p>
      </div>

      <div class="step-card">
        <div class="icon-circle">
          <mat-icon class="material-symbols-outlined icon-style">
            chat
          </mat-icon>
        </div>
        <h3>2. Contacta Vendedores</h3>
        <p>Comunícate directamente con los vendedores para hacer preguntas y negociar.</p>
      </div>

      <div class="step-card">
        <div class="icon-circle">
          <mat-icon class="material-symbols-outlined icon-style">
            check_circle
          </mat-icon>
        </div>
        <h3>3. Finaliza la Operación</h3>
        <p>Cierra tu trato de forma segura y coordina la entrega o recogida.</p>
      </div>
    </div>
  </section>

  <!-- User Dashboard Section -->
  <section class="dashboard-section" *ngIf="isAuthenticated">
    <div class="dashboard-content">
      <h2>¡Bienvenido de vuelta{{ currentUser?.first_name ? ', ' + currentUser?.first_name : '' }}!</h2>
      <p>Gestiona tus productos y encuentra nuevas oportunidades de negocio</p>
      <div class="dashboard-actions">
        <button class="dashboard-button primary" routerLink="/my-products">
          <mat-icon class="button-icon">inventory</mat-icon>
          Mis Productos
        </button>
        <button class="dashboard-button secondary" routerLink="/product">
          <mat-icon class="button-icon">add_circle</mat-icon>
          Publicar Producto
        </button>
      </div>
    </div>
  </section>

  <!-- Search Section -->
  <section class="search-section">
    <div class="search-container">
      <div class="search-card">
        <h2>¿Qué estás buscando?</h2>
        <div class="search-bar">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Buscar productos</mat-label>
            <input matInput 
                   placeholder="Ej: tractor, semillas, fertilizante..." 
                   [(ngModel)]="searchQuery" 
                   (keyup.enter)="searchProducts()">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
          <button class="search-button" mat-raised-button color="primary" (click)="searchProducts()">
            <mat-icon>search</mat-icon>
            Buscar
          </button>
        </div>
        <div class="category-filters">
          <button class="filter-btn" [class.active]="selectedCategory === ''"
            (click)="selectedCategory = ''; loadFeaturedProducts()">
            <mat-icon>apps</mat-icon>
            Todos
          </button>
          <button class="filter-btn" [class.active]="selectedCategory === 'transport'"
            (click)="loadProductsByCategory('transport')">
            <mat-icon>local_shipping</mat-icon>
            Transporte
          </button>
          <button class="filter-btn" [class.active]="selectedCategory === 'livestock'"
            (click)="loadProductsByCategory('livestock')">
            <mat-icon>agriculture</mat-icon>
            Ganado
          </button>
          <button class="filter-btn" [class.active]="selectedCategory === 'supplies'"
            (click)="loadProductsByCategory('supplies')">
            <mat-icon>grass</mat-icon>
            Suministros
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Products Section -->
  <section class="products-section">
    <div class="section-header">
      <h2>{{ selectedCategory ? 'Productos de ' + getCategoryName(selectedCategory) : 'Productos Destacados' }}</h2>
      <p>{{ hasError ? 'Mostrando datos de ejemplo' : 'Descubre los mejores productos de nuestros vendedores
        verificados' }}</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando productos...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-container">
      <mat-icon class="error-icon">warning</mat-icon>
      <p>{{ errorMessage }}</p>
      <button class="retry-button" (click)="loadFeaturedProducts()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!isLoading" class="products-grid">
      <div *ngFor="let product of products" class="product-card" (click)="viewProduct(product.id)">
        <div class="product-image">
          <img [src]="getPrimaryImage(product)" [alt]="product.title" class="product-img"
            (error)="onImageError($event)">
          <div class="product-category-badge">{{ getCategoryName(product.category) }}</div>
        </div>
        <div class="product-content">
          <h3 class="product-title">{{ product.title }}</h3>
          <p class="product-description" *ngIf="product.description && product.description.trim()">{{ product.description }}</p>
          <div class="product-price">
            <span class="price-current">{{ formatPrice(product) }}</span>
          </div>
          <div class="product-seller">
            <mat-icon class="seller-icon">person</mat-icon>
            <span>{{ product.seller_name || 'Vendedor' }}</span>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="products.length === 0 && !isLoading && !hasError" class="empty-state">
        <mat-icon class="empty-icon">inventory_2</mat-icon>
        <h3>No se encontraron productos</h3>
        <p>Intenta con otros términos de búsqueda o categorías.</p>
      </div>
    </div>
  </section>


</div>

<!-- Notification System -->
<div class="notification-container" [class.show]="showNotification">
  <div class="notification" [class]="'notification notification-' + notificationType">
    <div class="notification-content">
      <i class="notification-icon">
        {{ notificationType === 'success' ? '✓' : notificationType === 'error' ? '❌' : notificationType === 'warning' ?
        '⚠️' : 'ℹ️' }}
      </i>
      <span class="notification-message">{{ notificationMessage }}</span>
    </div>
    <button class="notification-close" (click)="closeNotification()">×</button>
  </div>
</div>